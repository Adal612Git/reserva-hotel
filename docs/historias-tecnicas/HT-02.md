# HT-02: Estructura del proyecto backend-node con rutas, controladores, modelos y middleware

---

## ğŸ§‘â€ğŸ’» Historia TÃ©cnica

**Como** equipo de desarrollo backend,  
**queremos** establecer una estructura modular y clara para el backend en Node.js,  
**para** facilitar el mantenimiento, escalabilidad y trabajo en equipo desde el inicio del proyecto.

---

## ğŸ“Œ Estatus  
âœ… Pendiente de desarrollo

---

## ğŸ¯ PriorizaciÃ³n  
Alta â€” Es la base para el desarrollo de todas las funcionalidades del backend.

---

## ğŸ‘¥ Actor TÃ©cnico Principal  
Desarrolladores backend

---

## ğŸ”— RelaciÃ³n con otras historias tÃ©cnicas

- **HT-01**: Configurar base de datos PostgreSQL con script `init.sql`  
- **HT-03**: Implementar JWT con middleware  
- **HT-04**: Conectar frontend con backend  
- **HT-08**: DocumentaciÃ³n Swagger  
- Todas las historias funcionales: desde HU-01 hasta HU-18 dependen de esta estructura

---

## ğŸ§± Requisitos Previos

- Tener Node.js y Express configurado
- Proyecto inicializado con `npm init`
- Variables de entorno definidas en `.env` (puerto, db, JWT, etc.)
- ConexiÃ³n a PostgreSQL usando ORM o cliente (ej. `pg`, `sequelize`, `knex`)

---

## âœ… Criterios de AceptaciÃ³n

### ğŸ¯ Criterio 1: Estructura modular por capas
- [ ] El proyecto debe estar dividido por capas:
  - **routes/** â†’ definiciÃ³n de rutas de la API
  - **controllers/** â†’ lÃ³gica de negocio
  - **models/** â†’ conexiÃ³n a la base de datos
  - **middlewares/** â†’ validaciones, autenticaciÃ³n, manejo de errores
  - **config/** â†’ conexiÃ³n a base de datos y otras configuraciones
  - **utils/** â†’ funciones auxiliares (formateo, validaciones, etc.)

### ğŸ¯ Criterio 2: OrganizaciÃ³n clara de rutas
- [ ] Las rutas deben estar separadas por dominio:
  - `auth.routes.js`
  - `usuarios.routes.js`
  - `reservas.routes.js`
  - `habitaciones.routes.js`
- [ ] El archivo principal (`server.js` o `index.js`) debe importar y registrar cada ruta

### ğŸ¯ Criterio 3: Controladores claros y sin lÃ³gica innecesaria
- [ ] Los controladores deben ser funciones puras que:
  - Reciben `req` y `res`
  - Llaman a modelos/servicios
  - Devuelven respuestas estructuradas (JSON, estado)

### ğŸ¯ Criterio 4: Middleware centralizado
- [ ] Deben existir middlewares para:
  - Verificar autenticaciÃ³n JWT
  - Validar roles (cliente, recepcionista, admin)
  - Manejar errores (try/catch centralizado)
  - Validar datos de entrada (opcional con Joi, Zod o express-validator)

---

## ğŸ”„ Flujo de implementaciÃ³n

1. Crear estructura base de carpetas
2. Configurar `server.js` con Express y conexiÃ³n DB
3. Crear routers bÃ¡sicos y conectarlos
4. AÃ±adir primer controlador (ej. login o registro)
5. AÃ±adir middlewares (auth, errores)
6. Probar el funcionamiento con rutas bÃ¡sicas

---

## ğŸ“‰ Flujos Alternativos / Consideraciones

### âŒ LÃ³gica duplicada o desordenada
- Debe evitarse tener lÃ³gica de negocio en las rutas directamente

### âŒ Controladores acoplados a la base de datos
- La capa `controller` no debe incluir sentencias SQL directamente (delegar a `models/`)

### âŒ Middleware global sin control
- Debe haber control de ejecuciÃ³n por ruta (no aplicar JWT a rutas pÃºblicas como `/login` o `/register`)

---

## ğŸ§ª Escenarios de prueba

### âœ”ï¸ Primer endpoint activo
```gherkin
Dado que el servidor Express estÃ¡ configurado
Cuando el usuario accede a /api/test
Entonces debe recibir una respuesta JSON: { "msg": "Servidor operativo" }
