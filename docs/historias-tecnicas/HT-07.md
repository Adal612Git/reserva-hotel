# HT-07: Hacer deploy del backend en Render o Railway

---

## ğŸ§‘â€ğŸ’» Historia TÃ©cnica

**Como** desarrollador backend,  
**quiero** desplegar el backend Node.js en Render o Railway,  
**para** que pueda ser accedido desde el frontend y estÃ© disponible pÃºblicamente para pruebas, demos o producciÃ³n.

---

## ğŸ“Œ Estatus  
âœ… Pendiente de desarrollo

---

## ğŸ¯ PriorizaciÃ³n  
Alta â€” Sin esto, el frontend en Vercel no puede conectarse al backend y el sistema no puede probarse completo.

---

## ğŸ‘¥ Actor TÃ©cnico Principal  
Backend / Infraestructura

---

## ğŸ”— RelaciÃ³n con otras historias tÃ©cnicas

- **HT-06**: Deploy del frontend en Vercel  
- **HT-04**: ConexiÃ³n entre frontend y backend  
- **HT-11**: Variables de entorno  
- **HT-01 / HT-02 / HT-03**: Todo el backend debe estar funcional antes del deploy

---

## ğŸ§± Requisitos Previos

- Backend funcionando localmente (sin errores en `npm start`)  
- Repositorio en GitHub con estructura modular (`controllers/`, `routes/`, etc.)  
- Base de datos PostgreSQL (local o en la nube: Railway, Supabase, ElephantSQL)  
- Archivo `.env` con configuraciones necesarias (PORT, DB_URL, JWT_SECRET, etc.)

---

## âœ… Criterios de AceptaciÃ³n

### ğŸ¯ Criterio 1: Deploy exitoso en plataforma
- [ ] El backend debe desplegarse correctamente en Railway o Render  
- [ ] El servicio debe exponer una URL pÃºblica (ej. `https://reserva-api.onrender.com`)

### ğŸ¯ Criterio 2: Variables de entorno configuradas
- [ ] Todas las variables crÃ­ticas deben estar definidas en el panel de configuraciÃ³n de la plataforma:
  - `PORT`
  - `DATABASE_URL`
  - `JWT_SECRET`
  - (otras segÃºn el proyecto)

### ğŸ¯ Criterio 3: Peticiones exitosas
- [ ] Las rutas protegidas y pÃºblicas deben funcionar desde herramientas como Postman o desde el frontend  
- [ ] El CORS debe permitir solicitudes desde el dominio de Vercel

---

## ğŸ”„ Flujo BÃ¡sico (Render)

1. Subir el backend a GitHub  
2. Ir a [https://dashboard.render.com](https://dashboard.render.com)  
3. Crear nuevo servicio: "Web Service"  
4. Seleccionar el repositorio del backend  
5. Configurar:
   - Start command: `npm start`  
   - Build command: `npm install` (si aplica)  
   - Node version (si aplica)  
   - Variables de entorno  
6. Render hace el deploy y da una URL pÃºblica

---

## ğŸ”„ Flujo BÃ¡sico (Railway)

1. Ir a [https://railway.app](https://railway.app)  
2. Crear un nuevo proyecto  
3. Vincular con GitHub o importar cÃ³digo  
4. Configurar variables de entorno  
5. Railway hace deploy automÃ¡tico  
6. Verificar la URL generada (ej. `https://reserva-hotel.up.railway.app`)

---

## ğŸ“‰ Flujos Alternativos

### âŒ Error de conexiÃ³n a base de datos
- Asegurar que la URL estÃ© bien escrita  
- Que la base de datos estÃ© desplegada y con IP pÃºblica habilitada

### âŒ CORS bloqueado
- Verificar que el backend permita el dominio del frontend en su middleware CORS

### âŒ Backend cae por falta de `PORT`
- Asegurar que la variable `PORT` estÃ© definida (Render la exige)

---

## ğŸ”’ Validaciones de Seguridad

- Nunca subir el archivo `.env` al repositorio  
- Usar variables de entorno en el panel de configuraciÃ³n  
- Activar HTTPS siempre (ambas plataformas lo hacen por defecto)  
- Evitar usar rutas de prueba o debug en producciÃ³n

---

## ğŸ§ª Escenarios de prueba

### âœ”ï¸ Ruta pÃºblica disponible
```gherkin
Dado que el backend fue desplegado en Render o Railway
Cuando se accede a /api/ping desde el navegador o Postman
Entonces debe responder con "pong" o algÃºn mensaje de test
