# HU-10: Cambiar el rol de un usuario

---

## ğŸ“ Historia de Usuario

**Como** administrador del sistema,  
**quiero** poder cambiar el rol de un usuario registrado (por ejemplo, de cliente a recepcionista),  
**para** otorgar o modificar los permisos de acceso segÃºn su funciÃ³n dentro del hotel.

---

## ğŸ“Œ Estatus  
âœ… Pendiente de desarrollo

---

## ğŸ¯ PriorizaciÃ³n  
Alta â€” Es una funciÃ³n crÃ­tica para la gestiÃ³n de permisos y seguridad del sistema.

---

## ğŸ‘¤ Actor Principal  
Administrador (usuario con rol autorizado)

---

## ğŸ”— RelaciÃ³n con otras historias de usuario

- **HU-17**: Ver lista de usuarios registrados  
- **HU-18**: Registrar recepcionista o admin manualmente  
- **HU-02**: Login de usuario (permite acceso segÃºn rol)  
- **CU-09**: Accesos diferenciados por rol  
- **HT-03**: Middleware de autorizaciÃ³n por rol

---

## ğŸ§± Requisitos Previos / Dependencias TÃ©cnicas

- Middleware para proteger acceso a esta funciÃ³n
- Interfaz de administraciÃ³n de usuarios con selector de rol
- Tabla `usuarios` con campo `rol` (ej. cliente, recepcionista, admin)
- Endpoint: `PUT /api/usuarios/:id/rol`
- Validaciones para impedir escalar privilegios maliciosamente

---

## âœ… Criterios de AceptaciÃ³n

### ğŸ¯ Criterio 1: Acceso restringido
- [ ] Solo administradores pueden ver y usar el panel de cambio de rol.
- [ ] Otros usuarios deben recibir error 403 si intentan acceder.

### ğŸ¯ Criterio 2: SelecciÃ³n clara de nuevo rol
- [ ] El panel debe mostrar el usuario actual con su rol.
- [ ] Debe permitir seleccionar uno nuevo desde una lista predefinida:  
  - cliente  
  - recepcionista  
  - admin  
- [ ] No se debe permitir modificar el rol de uno mismo (por seguridad).

### ğŸ¯ Criterio 3: AplicaciÃ³n inmediata del cambio
- [ ] Al guardar el nuevo rol, debe reflejarse inmediatamente en el sistema.
- [ ] Si el usuario estÃ¡ logueado, debe experimentar el nuevo rol al recargar sesiÃ³n o tras reautenticaciÃ³n.

---

## ğŸ”„ Flujo BÃ¡sico

1. El administrador accede al panel de â€œUsuariosâ€.
2. Ve la lista de usuarios registrados (HU-17).
3. Elige uno y hace clic en â€œCambiar Rolâ€.
4. Se abre un formulario o dropdown con los roles disponibles.
5. Selecciona un nuevo rol y presiona â€œGuardar cambiosâ€.
6. El sistema:
   - Verifica que el usuario seleccionado no sea Ã©l mismo.
   - Actualiza el campo `rol` en la base de datos.
   - Muestra confirmaciÃ³n visual.
7. El nuevo rol se aplica la prÃ³xima vez que el usuario inicie sesiÃ³n (o de inmediato si se refresca).

---

## ğŸ“‰ Flujos Alternativos

### âŒ Intento de cambiar el rol de uno mismo
- Mostrar advertencia:
  > â€œNo puedes modificar tu propio rol por seguridadâ€

### âŒ Usuario no existe
- Mostrar error:  
  > â€œEl usuario seleccionado no fue encontradoâ€

### âŒ Rol invÃ¡lido
- Mostrar validaciÃ³n:  
  > â€œRol seleccionado no permitidoâ€

---

## ğŸ”’ Validaciones de Seguridad

- Middleware que verifique que el usuario es admin
- ValidaciÃ³n de entrada en backend: solo roles vÃ¡lidos (`cliente`, `recepcionista`, `admin`)
- PrevenciÃ³n de escalamiento no autorizado (ej. un recepcionista que intente volverse admin vÃ­a hack)
- ValidaciÃ³n que impida modificar el rol del usuario que hace la peticiÃ³n

---

## ğŸ§ª Escenarios de prueba

### âœ”ï¸ Cambio de rol exitoso
```gherkin
Dado que el administrador accede al panel de usuarios
Y selecciona al usuario "Juan" con rol "cliente"
Cuando elige el nuevo rol "recepcionista" y guarda
Entonces el sistema debe actualizar el rol y mostrar mensaje de Ã©xito
