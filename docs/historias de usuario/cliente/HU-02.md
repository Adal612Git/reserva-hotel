# HU-02: Login de Cliente

---

## ğŸ“ Historia de Usuario

**Como** cliente previamente registrado,  
**quiero** iniciar sesiÃ³n en el sistema con mi correo y contraseÃ±a,  
**para** acceder a mi perfil, realizar reservas, ver disponibilidad y gestionar mis datos.

---

## ğŸ“Œ Estatus  
âœ… Pendiente de desarrollo

---

## ğŸ¯ PriorizaciÃ³n  
Alta â€” Necesario para acceder a todas las funcionalidades autenticadas del cliente.

---

## ğŸ‘¤ Actor Principal  
Cliente (usuario registrado en el sistema)

---

## ğŸ”— RelaciÃ³n con otras historias  
- HU-01: Registro de Cliente  
- HU-04: Ver mis reservas  
- HU-03: Crear nueva reserva  
- HT-03: Implementar JWT con middleware de protecciÃ³n por rol  
- HT-05: Crear interceptor JWT en Angular

---

## ğŸ§± Requisitos Previos / Dependencias TÃ©cnicas

- Base de datos con tabla de usuarios (`users`)
- ImplementaciÃ³n de autenticaciÃ³n en backend (Node.js) con JWT
- Middleware de validaciÃ³n de tokens y roles
- Interceptor de Angular para envÃ­o de tokens en headers
- Ruta `/api/auth/login` funcionando en backend
- Guardas en frontend para proteger rutas

---

## âœ… Criterios de AceptaciÃ³n

### ğŸ¯ Criterio 1: Formulario funcional
- [ ] El formulario debe tener dos campos: correo electrÃ³nico y contraseÃ±a.
- [ ] Ambos campos deben ser obligatorios.
- [ ] El correo debe validarse como formato `email@example.com`.
- [ ] La contraseÃ±a debe tener al menos 8 caracteres.

### ğŸ¯ Criterio 2: Inicio de sesiÃ³n exitoso
- [ ] Si el usuario ingresa credenciales vÃ¡lidas, se le debe redirigir a su panel principal.
- [ ] El backend debe responder con un JWT vÃ¡lido y datos del usuario.
- [ ] El frontend debe guardar el token en `localStorage` o `sessionStorage`.

### ğŸ¯ Criterio 3: Manejo de errores
- [ ] Si las credenciales son incorrectas, se debe mostrar un mensaje claro de error: â€œCorreo o contraseÃ±a incorrectosâ€.
- [ ] Si el usuario no existe, mostrar mensaje â€œUsuario no encontradoâ€.
- [ ] Si el servidor no responde, mostrar mensaje â€œError de conexiÃ³n, intÃ©ntalo mÃ¡s tardeâ€.

### ğŸ¯ Criterio 4: Seguridad
- [ ] El token JWT debe tener expiraciÃ³n configurada (recomendado: 2 horas).
- [ ] La contraseÃ±a nunca debe enviarse ni guardarse en texto plano.
- [ ] Los errores no deben revelar si el correo existe o no (para evitar enumeration attacks).

---

## ğŸ”„ Flujo BÃ¡sico

1. Usuario accede a la pantalla de login.
2. Llena los campos de correo y contraseÃ±a.
3. Presiona el botÃ³n â€œIniciar sesiÃ³nâ€.
4. El frontend hace `POST` a `/api/auth/login` con los datos.
5. El backend:
   - Verifica si el correo existe.
   - Compara la contraseÃ±a con el hash guardado (bcrypt).
   - Si todo es correcto, genera un JWT.
6. El frontend guarda el token y redirige al dashboard del cliente.
7. En caso de error, se muestra un mensaje adecuado.

---

## ğŸ“‰ Flujo Alternativo

- Si el usuario ya tiene sesiÃ³n activa (token vÃ¡lido en `localStorage`), se redirige automÃ¡ticamente a su dashboard.
- Si se detecta token expirado, se debe cerrar sesiÃ³n y mostrar mensaje: â€œTu sesiÃ³n ha expiradoâ€.

---

## ğŸ”’ Validaciones de Seguridad

- Hash de contraseÃ±a en backend (bcrypt)
- ValidaciÃ³n de credenciales sin revelar detalles
- JWT con expiraciÃ³n y firmado con clave secreta en `.env`
- Interceptor
